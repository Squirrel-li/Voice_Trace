<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>帳號管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="./css/main.css" />
</head>
<body>
    <header>
        <h1>SpeakTrace 帳號中心</h1>
        <p>註冊、登入、管理帳號並處理影音內容</p>
    </header>
    <main id="app">
        <nav>
            <button :class="{ active: view==='login' }" @click="view='login'">登入</button>
            <button :class="{ active: view==='register' }" @click="view='register'">註冊</button>
            <button :class="{ active: view==='profile' }" @click="view='profile'" :disabled="!session.loggedIn">帳號管理</button>
            <button :class="{ active: view==='library' }" @click="view='library'" :disabled="!session.loggedIn">影音資料庫</button>
        </nav>

        <section v-if="view==='login'" class="card">
            <h2>登入帳號</h2>
            <form @submit.prevent="login">
                <div>
                    <label for="login-email">電子郵件</label>
                    <input id="login-email" v-model="loginForm.email" type="email" required />
                </div>
                <div>
                    <label for="login-password">密碼</label>
                    <input id="login-password" v-model="loginForm.password" type="password" required minlength="6" />
                </div>
                <button type="submit">登入</button>
            </form>
            <p class="error" v-if="messages.error">{{ messages.error }}</p>
            <p class="success" v-if="messages.success">{{ messages.success }}</p>
        </section>

        <section v-else-if="view==='register'" class="card">
            <h2>建立新帳號</h2>
            <form @submit.prevent="register">
                <div>
                    <label for="register-name">姓名</label>
                    <input id="register-name" v-model="registerForm.name" required />
                </div>
                <div>
                    <label for="register-email">電子郵件</label>
                    <input id="register-email" v-model="registerForm.email" type="email" required />
                </div>
                <div>
                    <label for="register-password">密碼</label>
                    <input id="register-password" v-model="registerForm.password" type="password" required minlength="6" />
                </div>
                <div>
                    <label for="register-password2">確認密碼</label>
                    <input id="register-password2" v-model="registerForm.confirm" type="password" required minlength="6" />
                </div>
                <button type="submit">註冊</button>
            </form>
            <p class="error" v-if="messages.error">{{ messages.error }}</p>
            <p class="success" v-if="messages.success">{{ messages.success }}</p>
        </section>

        <section v-else-if="view==='profile'" class="card">
            <h2>個人資料</h2>
            <form @submit.prevent="updateProfile">
                <div>
                    <label for="profile-name">姓名</label>
                    <input id="profile-name" v-model="profileForm.name" required />
                </div>
                <div>
                    <label for="profile-email">電子郵件</label>
                    <input id="profile-email" v-model="profileForm.email" type="email" required />
                </div>
                <div>
                    <label for="profile-password">更新密碼（選填）</label>
                    <input id="profile-password" v-model="profileForm.password" type="password" minlength="6" />
                </div>
                <button type="submit">儲存變更</button>
            </form>
            <p class="success" v-if="messages.success">{{ messages.success }}</p>
            <p class="error" v-if="messages.error">{{ messages.error }}</p>
        </section>

        <section v-else-if="view==='library'" class="card">
            <h2>影音資料庫</h2>
            <form @submit.prevent="uploadMedia">
                <div>
                    <label for="media-title">標題</label>
                    <input id="media-title" v-model="uploadForm.title" placeholder="例如：會議錄音" required />
                </div>
                <div>
                    <label for="media-file">選擇檔案</label>
                    <input id="media-file" type="file" accept="audio/*,video/*" @change="handleFile" required />
                    <small>支援音訊與影片格式</small>
                </div>
                <button type="submit" :disabled="!uploadForm.file">上傳</button>
            </form>
            <p class="success" v-if="messages.success">{{ messages.success }}</p>
            <p class="error" v-if="messages.error">{{ messages.error }}</p>

            <h3>已上傳內容</h3>
            <div class="list">
                <div class="list-item" v-for="item in library" :key="item.id">
                    <div>
                        <strong>{{ item.title }}</strong>
                        <div class="status-pill">{{ item.type.toUpperCase() }}</div>
                        <small>上傳時間：{{ item.uploadedAt }}</small>
                    </div>
                    <div class="actions">
                        <button @click="download(item)">下載</button>
                        <button class="danger" @click="remove(item)">刪除</button>
                    </div>
                </div>
            </div>
        </section>
    </main>


    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="./js/main.js"></script>
</body>
</html>